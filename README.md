# LINE 記帳機器人

一個簡單易用的 LINE 記帳機器人，幫助你快速記錄日常支出。

## ✨ 主要特色

- 🤖 **@ai 格式記帳** - 明確區分記帳和聊天，避免誤判
- 📝 **簡化記帳** - 只記錄原因和金額，快速記帳
- 📊 **智能統計** - 自動統計月度和歷史支出
- 🔄 **彈性重置** - 可重置當前統計金額
- 🌐 **網頁管理** - 後台管理界面，可查看和刪除記錄
- ☁️ **雲端部署** - 部署在 Render，穩定可靠

## 🚀 使用方式

### 📱 LINE 記帳

**新格式要求**：必須以 `@ai` 開頭

```
@ai 原因 金額
```

**範例**：
- `@ai 午餐 120`
- `@ai 咖啡 50元`
- `@ai 停車費 30塊`
- `@ai 買飲料 45`
- `@ai 電影票 280`

### 📋 查詢指令

- `查詢` - 查看最近 5 筆記錄
- `本月` - 本月支出摘要
- `總金額` - 每月總金額統計
- `當前統計` - 當前累積統計金額 ⭐
- `統計` - 歷史總統計報告
- `重新統計` - 重置當前統計金額
- `記帳` - 查看記帳格式說明
- `幫助` - 顯示完整說明

## 💰 支援的金額格式

- 純數字：`120`
- 中文單位：`120元`、`50塊`、`30錢`
- 貨幣符號：`NT$100`、`$80`
- 動詞表達：`花了60`

## 🛡️ 安全機制

- ⚠️ **重要**：只有以 `@ai` 開頭的訊息才會被識別為記帳指令
- 🤖 其他訊息會被當作一般聊天，不會觸發記帳
- 🔐 避免誤判，保護資料安全

## 🌐 網頁管理功能

### 管理界面功能
- 📊 **用戶統計總覽** - 查看所有用戶的記錄統計
- 👤 **用戶詳細資料** - 顯示用戶真實姓名和頭像
- 📋 **記錄管理** - 查看、搜尋所有記錄

### 刪除功能
- 🗑️ **單筆刪除** - 刪除特定記錄
- 📦 **批量刪除** - 選擇多筆記錄批量刪除
- 🧹 **清空用戶** - 清空特定用戶的所有記錄
- ⚠️ **安全確認** - 所有刪除操作都有確認機制

### 存取方式
- 管理首頁：`你的網址/admin`
- 所有記錄：`你的網址/admin/expenses`
- 用戶詳情：`你的網址/admin/user/[USER_ID]`
- 版本資訊：`你的網址/version`

## 🛠️ 技術架構

- **後端框架**：Flask
- **資料庫**：SQLite (本地) / PostgreSQL (線上)
- **部署平台**：Render
- **LINE API**：LINE Bot SDK
- **前端**：原生 HTML/CSS/JavaScript

## 📊 統計功能

### 當前統計 vs 歷史統計
- **當前統計**：從重置日期開始累積的金額
- **歷史統計**：包含所有時間的記錄
- **重新統計**：只重置當前金額，保留所有歷史記錄

### 月度統計
- 自動按月份統計支出
- 顯示每月總金額和筆數
- 計算平均每筆支出

## 🔧 本地調試

提供多種本地調試工具：

### debug_local.py
```bash
python debug_local.py
```
- 自動測試模式
- 互動式記帳測試
- 查詢現有記錄

### verify_db.py
```bash
python verify_db.py
```
- 驗證資料庫持久化
- 檢查資料完整性

### test_ai_format.py
```bash
python test_ai_format.py
```
- 測試新的 @ai 格式
- 驗證解析功能

## 📄 授權

MIT License

---

🤖 **LINE 記帳機器人** - 讓記帳變得更簡單！ 